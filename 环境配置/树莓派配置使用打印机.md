# 树莓派配置使用打印机

> 在树莓派端，通过USB口连接打印机，对打印机进行配置，控制打印机的**打印**和**扫描**功能；本配置采用了HP的一款打印机
>
> > 属于是导师派活...:expressionless:

## 1. 打印配置

### 1.1 配置流程

#### 驱动确定

由于确定使用HP家的打印机，因此进入HP的官网：

https://developers.hp.com/hp-linux-imaging-and-printing/supported_devices/index

查询打印机是否支持Linux的驱动

#### 驱动安装

* 进入树莓派控制窗口，运行以下命令：

```bash
sudo apt-get install hplip
```

> 最好换成国内的镜像进行下载：
>
> https://blog.csdn.net/la9998372/article/details/77886806
>
> **注**：换了源之后出现了无法自动安装依赖包的情况，需要将`stretch `更换为`buster`，例如：`deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi`修改为`deb http://mirrors.tuna.tsinghua.edu.cn/raspbian/raspbian/ buster main contrib non-free rpi`

* 再运行命令，**将pi用户 加入到 lpadmin**：

```bash
sudo usermod -a -G lpadmin pi
```

* 成功之后安装`hplip-gui`，通过以下命令：

```bash
sudo apt-get install hplip-gui
```

* 安装成功后进行如下步骤：
  * 在终端输入`hp-setup`
  * 在弹出的窗口中选择`Universal Serial Bus(USB)`--->`next`
  * 选择打印机，此处我的打印机为`HP LaserJet MFP m227-m231`选择它--->`next`
    * 注：若无打印机，则插拔一下打印机的USB线
  * 在下一界面中，勾选`Printer Setup`--->`Add Printer`
    * `Fax Setup`为传真机功能，可不勾选
  * 会弹出输入用户名和密码的框，输入即可
  * 至此打印机已经配置成功了
* 选择默认的打印机，我是通过`菜单栏`->`Preference`->`HPLIP Toolbox`->`Printer Control`里选择打印机为默认的打印机`Set as Default`
  * 若未设置成功，重启一下再设置即

### 1.2 使用流程

* `lsusb`：查看连接的USB设备

* `CUPS`命令：

  ```bash
  lpstat
  -a	# 显示打印机的接受状态。
  -c	# 显示打印类。
  -p	# 显示打印状态：已启用或已禁用。
  -s	# 显示默认的一个或多个打印机和类。等效于 -d、 -c 和  -v。请注意，必须将多个选项隔开，因为可为许多选项指定值。
  -s	# 显示打印机及其设备。
  ```

* `lp`：**打印命令**

  ```bash
  lp -P 指定打印机(若已经设置了默认打印机，则不需要指定) 文件名
  # eg：
  lp ./Desktop/test.jpg
  ```

  > 更高级指令这里不在贴出

## 2. 扫描仪配置

### 2.1 安装驱动

* 打开终端运行如下命令：

```bash
sudo apt-get install sane
sudo hp-plugin
```

> 在运行`sudo hp-plugin`命令时，按照提示输入相关的y/n之类的；
>
> **注：**若出现安装失败等情况，可去网站自行下载插件：<https://www.openprinting.org/download/printdriver/auxfiles/HP/plugins/> 
>
> ps：
>
> 我安装失败了，出现问题**error: Unable to recieve key from keyserver**，不需要管选择'y'继续安装；之后就是接受许可，完成安装；
>
> 后续：从惠普是否支持打印的驱动网站的表格中，存在`Driver Plug-in`这么一栏，后续的解释说明中提到：
>
> > 8 ("Required") A downloadable driver plug-in is required for printing support. ("Optional") A downloadable driver plug-in is optional for printing support and may increase the speed, quality, or other aspect of printed output. ("No" or "None") A driver plug-in is not required nor available. Driver plug-ins are released under a proprietary (non-open) license and are not part of the HPLIP tarball release. For more information, please refer to this KB article
> >
> > 就是说，若是NO，则这个驱动插件是不需要的

* 查看打印机设备

```bash
sudo sane-find-scanner
# 在输出的信息中，我能找到这么一串信息
# found USB scanner (vendor=0x03f0 [HP], product=0x642a [HP LaserJet MFP M227-M231]) at libusb:001:004
```

使用命令`scanimage -L`查看扫描仪的具体型号

### 2.2 扫描文档

```bash
# 1.加上设备名
scanimage -d 打印机的设备名称(通过上述scanimage -L命令获取的) > 输出的地址和文件名字
# scanimage -d hpaio:/usb/HP_LaserJet_MFP_M227-M231?serial=VNL3D12026 >./Desktop/test.jpg
# ------------------------------------------------------------#
# 2.可以选择不加设备名
scanimage > 路径+文件名
# eg：scanimage > ./Desktop/scan.jpg
```

> 通过`scanimage --help`来获取改命令的帮助，例如设置扫描的大小，格式等参数设置


## 参考

**打印：**

https://blog.csdn.net/u012939880/article/details/93748342

https://developers.hp.com/hp-linux-imaging-and-printing/install/install/index

https://blog.csdn.net/nullpointer2008/article/details/79664253

**扫描：**

https://blog.csdn.net/wdkirchhoff/article/details/52536846

https://blog.csdn.net/wdkirchhoff/article/details/52536846